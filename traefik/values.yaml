# Traefik Helm Chart values
# https://github.com/traefik/traefik-helm-chart

image:
  tag: v3.2

# Deployment configuration
deployment:
  replicas: 1
  revisionHistoryLimit: 1

# Entry points configuration
# Use high ports inside container (non-privileged) while exposing 80/443 on the LoadBalancer
ports:
  web:
    port: 8000
    expose:
      default: true
    exposedPort: 80
    protocol: TCP
  websecure:
    port: 8443
    expose:
      default: true
    exposedPort: 443
    protocol: TCP
  traefik:
    port: 8080
    expose:
      default: false

# Service configuration
service:
  type: LoadBalancer

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 64Mi
  limits:
    cpu: 300m
    memory: 128Mi

# Kubernetes providers
providers:
  kubernetesCRD:
    enabled: false
  kubernetesIngress:
    enabled: false
  kubernetesGateway:
    enabled: true

# Gateway API - disable helm chart Gateway, we create it manually for full control
gateway:
  enabled: false

# Enable ping for health checks
ping:
  entryPoint: traefik

# Disable dashboard exposure (access via port-forward if needed)
ingressRoute:
  dashboard:
    enabled: false

# Security context - no privileged capabilities needed with high ports
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# Pod security context
podSecurityContext:
  runAsNonRoot: true

# Logging
logs:
  general:
    level: INFO

# GatewayClass configuration - Traefik Helm chart creates this automatically
gatewayClass:
  enabled: true
  name: traefik

# Extra objects to deploy - Gateway resource for Gateway API
extraObjects:
  - apiVersion: gateway.networking.k8s.io/v1
    kind: Gateway
    metadata:
      name: traefik-gateway
      namespace: traefik
    spec:
      gatewayClassName: traefik
      listeners:
        - name: web
          port: 80
          protocol: HTTP
          allowedRoutes:
            namespaces:
              from: All
        - name: websecure
          port: 443
          protocol: HTTPS
          tls:
            mode: Terminate
            certificateRefs:
              - kind: Secret
                name: argocd-tls
                namespace: argocd
          allowedRoutes:
            namespaces:
              from: All
